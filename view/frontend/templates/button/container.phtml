<?php
    $config = $block->getConfig();
    if ($config && $block->purchaseHelper->canDisplayButton()) {
        $purchaseData = $block->purchaseHelper->getPurchaseData();


        var_dump($purchaseData);exit();
?>
    <div id="aip-<?= $block->getProduct()->getId() ?>" class="aip-button-container">
        <button 
            type="button"
            class="<?= $block->purchaseHelper->getButtonCss() ?> action primary instant-purchase aip-button"
            <?= $block->purchaseHelper->getButtonState() ?>
            title="<?= __($config['general']['button_text']) ?>">
            <?= __($config['general']['button_text']) ?>
        </button>
    </div>

    <input type="hidden" name="instant_purchase_payment_token" value="<?= $purchaseData['paymentToken']['publicHash'] ?>" />
    <input type="hidden" name="instant_purchase_shipping_address" value="<?= $purchaseData['shippingAddress']['id'] ?>" />
    <input type="hidden" name="instant_purchase_billing_address" value="<?= $purchaseData['billingAddress']['id'] ?>" />
    <input type="hidden" name="instant_purchase_carrier" value="<?= $purchaseData['shippingMethod']['carrier_code'] ?>" />
    <input type="hidden" name="instant_purchase_shipping" value="<?= $purchaseData['shippingMethod']['method_code'] ?>" />

    <script type="text/x-magento-init">
        {
            "*": {
                "aip": <?= json_encode($this->customerHelper->getUserParams()) ?>
            }
        }
    </script>
<?php } ?>